<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Mentions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SNA4Slack</a> &gt; <a href="index.source.html" class="el_package">snaforslack.obj.global</a> &gt; <span class="el_source">Mentions.java</span></div><h1>Mentions.java</h1><pre class="source lang-java linenums">package snaforslack.obj.global;

import java.util.List;

import snaforslack.data.list.ListUsers;
import snaforslack.data.list.ListUsersMentions;
import snaforslack.data.structures.SlackUserMentions;
import snaforslack.interfaces.json.IntJsonArray;
import snaforslack.interfaces.json.IntJsonObject;
import snaforslack.interfaces.list.IntListUserMentions;
import snaforslack.interfaces.list.IntListUsers;
import snaforslack.interfaces.obj.IntObjMentions;
import snaforslack.interfaces.obj.IntObjUsers;
import snaforslack.interfaces.structures.IntChannel;
import snaforslack.interfaces.structures.IntUser;
import snaforslack.interfaces.structures.IntUserMentions;

/**
 * Contains and manages all of the mentions in the workspace.
 */
public class Mentions implements IntObjMentions {

	/**
	 * List of globalUsers.
	 */
	private final IntObjUsers globalUsers;
	/**
	 * List of globalMentions.
	 */
	private final IntListUserMentions globalMentions;
	/**
	 * Indicates if the weight is required.
	 */
	private final boolean weighed;

	/**
	 * Initializes and allocates the space for the class attribute.
	 *
	 * @param users
	 *            a List of user.
	 * @param weight
	 *            a boolean value.
	 */
<span class="nc" id="L44">	public Mentions(final IntObjUsers users, final boolean weight) {</span>
<span class="nc" id="L45">		this.globalUsers = users;</span>

<span class="nc" id="L47">		this.globalMentions = new ListUsersMentions();</span>
<span class="nc" id="L48">		this.weighed = weight;</span>
<span class="nc" id="L49">	}</span>

	@Override
	/**
	 * Fills the class attributes with the needed data.
	 *
	 * @param jarray
	 *            a JSON array.
	 * @param name
	 *            a specified channel name.
	 */
	public final void initializeFromJsonArray(final IntJsonArray jarray, final IntChannel channel) {
<span class="nc bnc" id="L61" title="All 2 branches missed.">		if (jarray != null) {</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">			for (final IntJsonObject json : jarray.getList()) {</span>
<span class="nc" id="L63">				final String sender = json.getSender();</span>
<span class="nc" id="L64">				final List&lt;String&gt; receivers = json.getReceivers();</span>
<span class="nc" id="L65">				final IntUser user = this.globalUsers.getUser(sender);</span>
<span class="nc" id="L66">				final IntListUsers usersList = new ListUsers();</span>

<span class="nc bnc" id="L68" title="All 2 branches missed.">				for (final String receiver : receivers) {</span>
<span class="nc bnc" id="L69" title="All 4 branches missed.">					if (this.globalUsers.checkUser(receiver) &amp;&amp; channel.checkUser(receiver)) {</span>
<span class="nc" id="L70">						usersList.addUser(globalUsers.getUser(receiver));</span>
					}
<span class="nc" id="L72">				}</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">				if (!usersList.listIsEmpty()) {</span>
<span class="nc" id="L74">					final IntUserMentions userMentions = new SlackUserMentions(user, usersList.getUsersList());</span>
<span class="nc" id="L75">					this.mergeMentions(userMentions);</span>
				}
<span class="nc" id="L77">			}</span>
		}
<span class="nc" id="L79">	}</span>

	/**
	 * Merges two mentions if the are equals.
	 *
	 * @param userMentions
	 *            The mentions to merge.
	 **/
	private void mergeMentions(final IntUserMentions userMentions) {
<span class="nc bnc" id="L88" title="All 2 branches missed.">		if (this.globalMentions.isEmpty()) {</span>
<span class="nc" id="L89">			this.globalMentions.addMentions(userMentions);</span>
		} else {
<span class="nc bnc" id="L91" title="All 2 branches missed.">			if (globalMentions.checkSender(userMentions.getSenderId())) {</span>
<span class="nc" id="L92">				globalMentions.addMissingReceivers(userMentions);</span>
			} else {
<span class="nc" id="L94">				this.globalMentions.addMentions(userMentions);</span>
			}
		}
<span class="nc" id="L97">	}</span>

	@Override
	/**
	 * prints all of the mentions.
	 */
	public void printList() {
<span class="nc bnc" id="L104" title="All 2 branches missed.">		if (this.globalMentions.getMentionsList().isEmpty()) {</span>
<span class="nc" id="L105">			System.out.println(&quot;NONE MENTIONS&quot;);</span>
		} else {
<span class="nc bnc" id="L107" title="All 2 branches missed.">			for (final IntUserMentions userMentions : this.globalMentions.getMentionsList()) {</span>
<span class="nc" id="L108">				final List&lt;IntUser&gt; listUsers = userMentions.getListReceiver();</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">				for (final IntUser user : listUsers) {</span>
<span class="nc" id="L110">					final String senderName = userMentions.getSenderName();</span>
<span class="nc" id="L111">					final String receiverName = user.getUserName();</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">					if (this.weighed) {</span>
<span class="nc" id="L113">						System.out.println(&quot;FROM: &quot; + senderName + &quot; TO: &quot; + receiverName + &quot; WEIGHT: &quot;</span>
<span class="nc" id="L114">								+ userMentions.getWeight(user.getUserId()));</span>
					} else {
<span class="nc" id="L116">						System.out.println(&quot;FROM: &quot; + senderName + &quot; TO: &quot; + receiverName);</span>
					}
<span class="nc" id="L118">				}</span>
<span class="nc" id="L119">				System.out.println(&quot;&quot;);</span>
<span class="nc" id="L120">			}</span>
		}
<span class="nc" id="L122">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>